{% extends "base.html" %}

{% block title %}Lista de Tickets{% endblock %}

{% block content %}
<div class="container my-4 p-4" style="background-color: #f7faff; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
    <h2 class="text-center text-primary mb-4">Lista de Tickets</h2>

    <!-- Filtros de búsqueda -->
    <form method="get" class="form-inline mb-3">
        <div class="form-group mr-3">
            <label for="filtro_prioridad" class="mr-2">Prioridad:</label>
            <select name="filtro_prioridad" id="filtro_prioridad" class="form-control">
                <option value="">Todas</option>
                <option value="alta" {% if filtro_prioridad == "alta" %}selected{% endif %}>Alta</option>
                <option value="media" {% if filtro_prioridad == "media" %}selected{% endif %}>Media</option>
                <option value="baja" {% if filtro_prioridad == "baja" %}selected{% endif %}>Baja</option>
            </select>
        </div>

        <div class="form-group mr-3">
            <label for="filtro_estado" class="mr-2">Estado:</label>
            <select name="filtro_estado" id="filtro_estado" class="form-control">
                <option value="">Todos</option>
                <option value="abierto" {% if filtro_estado == "abierto" %}selected{% endif %}>Abierto</option>
                <option value="en_proceso" {% if filtro_estado == "en_proceso" %}selected{% endif %}>En Proceso</option>
                <option value="cerrado" {% if filtro_estado == "cerrado" %}selected{% endif %}>Cerrado</option>
            </select>
        </div>

        <button type="submit" class="btn btn-primary mr-2">Filtrar</button>
        <a href="{% url 'consultar_tickets' %}" class="btn btn-secondary">Restablecer Filtros</a>
    </form>

    <table class="table table-hover">
        <thead style="background-color: #007bff; color: white;">
            <tr>
                <th>Nombre del Solicitante</th>
                <th>Servicio</th>
                <th>Prioridad</th>
                <th>Estado</th>
                <th>Fecha de Creación</th>
                <th>Acción</th>
            </tr>
        </thead>
        <tbody>
            {% for ticket in tickets %}
            <tr style="background-color: {% cycle '#ffffff' '#f0f8ff' %};">
                <td>{{ ticket.nombre_solicitante }}</td>
                <td>{{ ticket.servicio }}</td>
                <td>{{ ticket.prioridad }}</td>
                <td>
                    <span class="badge {% if ticket.estado == 'abierto' %}badge-danger{% elif ticket.estado == 'en_proceso' %}badge-warning{% else %}badge-success{% endif %}">
                        {{ ticket.get_estado_display }}
                    </span>
                </td>
                <td>{{ ticket.fecha_creacion|date:"d/m/Y H:i" }}</td>
                <td>
                    <!-- Botón para tomar el ticket -->
                    <form action="{% url 'tomar_ticket' ticket.id %}" method="post" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-primary btn-sm">Tomar Ticket</button>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center text-muted">No hay tickets disponibles.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
